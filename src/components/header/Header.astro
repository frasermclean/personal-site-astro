---
import SiteLogo from './SiteLogo.astro';
import HeaderLink from './HeaderLink.astro';
import ThemeToggle from './ThemeToggle.astro';
import SocialLinks from './SocialLinks.astro';

const internalLinks = [
  { href: '/', text: 'Home' },
  { href: '/portfolio', text: 'Portfolio' },
  { href: '/about', text: 'About' },
  { href: '/blog', text: 'Blog' },
  { href: '/contact', text: 'Contact' },
];
---

<header class="bg-background text-foreground border-b sw-header">
  <nav class="mx-auto max-w-6xl px-4 py-2 flex items-center justify-between">
    <div class="flex items-center gap-3">
      <a class="no-underline hover:opacity-90 flex items-center gap-2" href="/" aria-label="Home">
        <SiteLogo size={48} />
      </a>
      <div class="internal-links hidden md:flex items-center gap-2 ml-1">
        {
          internalLinks.map((link) => (
            <HeaderLink href={link.href} class="px-2 py-3 text-[color:var(--color-text-secondary)] no-underline">
              {link.text}
            </HeaderLink>
          ))
        }
      </div>
    </div>
    <div class="flex items-center gap-3">
      <SocialLinks class="hidden md:flex items-center gap-3" />
      <ThemeToggle />
      <button
        type="button"
        aria-label="Open menu"
        aria-controls="mobile-menu"
        aria-expanded="false"
        data-menu-btn
        class="md:hidden inline-flex items-center justify-center w-10 h-10 rounded-lg text-[color:var(--color-text-secondary)] hover:text-white"
      >
        <svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true"
          ><path fill="currentColor" d="M3 6h18v2H3V6Zm0 5h18v2H3v-2Zm0 5h18v2H3v-2Z"></path></svg
        >
      </button>
    </div>
  </nav>
  <div id="mobile-menu" class="md:hidden hidden border-t">
    <div class="mx-auto max-w-6xl px-4 py-3 flex flex-col gap-2">
      <div class="flex flex-col">
        {
          internalLinks.map((link) => (
            <HeaderLink href={link.href} class="px-2 py-3">
              {link.text}
            </HeaderLink>
          ))
        }
      </div>
      <SocialLinks class="flex items-center gap-4 pt-2" />
    </div>
  </div>
</header>

<script>
  const button = document.querySelector('[data-menu-btn]');
  const panel = document.getElementById('mobile-menu');

  function isMenuOpen() {
    return panel && !panel.classList.contains('hidden');
  }

  function toggleMenu() {
    if (!panel || !button) return;
    const isOpen = isMenuOpen();
    if (isOpen) {
      panel.classList.add('hidden');
      button.setAttribute('aria-expanded', 'false');
    } else {
      panel.classList.remove('hidden');
      button.setAttribute('aria-expanded', 'true');
    }
  }

  button?.addEventListener('click', toggleMenu);
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      if (isMenuOpen()) {
        toggleMenu();
      }
    }
  });

  document.addEventListener('click', (e) => {
    if (!panel || !button) return;
    const target = e.target as Node;
    const clickedInside = panel.contains(target) || button.contains(target);
    if (!clickedInside && !isMenuOpen()) {
      toggleMenu();
    }
  });
</script>
